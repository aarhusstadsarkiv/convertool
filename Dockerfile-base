FROM python:3.11.9-bullseye AS base
ARG DEBIAN_FRONTEND=noninteractive
RUN apt update && apt install -y curl wget git cmake apt-transport-https software-properties-common ca-certificates
RUN rm -rf /var/lib/apt/lists/*

# Install pipx
RUN pip3 install pipx
ENV PATH="/root/.local/bin:$PATH"

# Install GDAL
RUN apt update && apt install -y libproj-dev gdal-bin

# Install GhostScript, Libreoffice, and imagemagick
RUN apt update && apt install -y ghostscript libreoffice ffmpeg imagemagick libc6-i386 libc6-x32 libxtst6

# Install chrome
WORKDIR /root
RUN curl -L https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb -o /root/google-chrome-stable_current_amd64.deb
RUN apt update && apt install -y /root/google-chrome-stable_current_amd64.deb
RUN ln -s $(which google-chrome-stable) /usr/bin/chrome

# Install QCAD
WORKDIR /root
RUN mkdir -p /root/qcad
RUN curl https://qcad.org/archives/qcad/qcadcam-3.28.2-trial-linux-x86_64.run -o /root/qcad/qcadcam-3.28.2-trial-linux-x86_64.run
RUN chmod a+x /root/qcad/qcadcam-3.28.2-trial-linux-x86_64.run
RUN /root/qcad/qcadcam-3.28.2-trial-linux-x86_64.run